/// <reference path="../pb_data/types.d.ts" />
migrate((db) => {
  const dao = new Dao(db)
  const collection = dao.findCollectionByNameOrId("4a49mdbu0igd28u")

  collection.options = {
    "query": "SELECT id,created,updated,invoice,booker, party,type,amount,paid,description from (SELECT\n  payments.id,\n  payments.created,\n  payments.updated,\n  payments.invoice,\n  invoice_view.booker,\n  payments.party AS party,\n  payments.type AS type,\n(CASE WHEN payments.amount <> 0 THEN payments.amount ELSE invoice_view.final_total END) AS amount,\n  paid,\n  payments.description\nFROM payments\nLEFT JOIN invoice_view ON payments.invoice = invoice_view.id)"
  }

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "olf4njrr",
    "name": "invoice",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "tpgfxlxy",
    "name": "booker",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "gvrggmwf",
    "name": "party",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "fasvfhz4",
    "name": "type",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "qfj1yvah",
    "name": "amount",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "07z6kpvc",
    "name": "paid",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  // add
  collection.schema.addField(new SchemaField({
    "system": false,
    "id": "jpujtjko",
    "name": "description",
    "type": "json",
    "required": false,
    "presentable": false,
    "unique": false,
    "options": {}
  }))

  return dao.saveCollection(collection)
}, (db) => {
  const dao = new Dao(db)
  const collection = dao.findCollectionByNameOrId("4a49mdbu0igd28u")

  collection.options = {
    "query": "SELECT id from (SELECT\n  payments.id,\n  payments.created,\n  payments.updated,\n  payments.invoice,\n  invoice_view.booker,\n  payments.party AS party,\n  payments.type AS type,\n(CASE WHEN payments.amount <> 0 THEN payments.amount ELSE invoice_view.final_total END) AS amount,\n  paid,\n  payments.description\nFROM payments\nLEFT JOIN invoice_view ON payments.invoice = invoice_view.id)"
  }

  // remove
  collection.schema.removeField("olf4njrr")

  // remove
  collection.schema.removeField("tpgfxlxy")

  // remove
  collection.schema.removeField("gvrggmwf")

  // remove
  collection.schema.removeField("fasvfhz4")

  // remove
  collection.schema.removeField("qfj1yvah")

  // remove
  collection.schema.removeField("07z6kpvc")

  // remove
  collection.schema.removeField("jpujtjko")

  return dao.saveCollection(collection)
})
